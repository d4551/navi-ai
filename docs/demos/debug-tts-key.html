<!DOCTYPE html>
<html>
<head>
    <title>Debug TTS Key Detection</title>
</head>
<body>
    <h1>üîç TTS Key Detection Debug</h1>
    <div id="results"></div>
    
    <script type="module">
        async function debugKeyDetection() {
            const results = document.getElementById('results');
            
            // Check environment variables available to the browser
            results.innerHTML += '<h2>üìã Environment Check:</h2>';
            results.innerHTML += `<p>import.meta.env.VITE_GEMINI_API_KEY: ${import.meta.env.VITE_GEMINI_API_KEY ? `‚úÖ SET (${import.meta.env.VITE_GEMINI_API_KEY.substring(0,8)}...)` : '‚ùå NOT SET'}</p>`;
            
            // Check localStorage
            results.innerHTML += '<h2>üíæ Storage Check:</h2>';
            try {
                const appSettings = localStorage.getItem('app-settings');
                if (appSettings) {
                    const settings = JSON.parse(appSettings);
                    results.innerHTML += `<p>localStorage app-settings: ${settings.geminiApiKey ? `‚úÖ SET (${settings.geminiApiKey.substring(0,8)}...)` : '‚ùå NOT SET'}</p>`;
                } else {
                    results.innerHTML += '<p>localStorage app-settings: ‚ùå NOT SET</p>';
                }
            } catch (error) {
                results.innerHTML += `<p>localStorage error: ${error.message}</p>`;
            }
            
            // Try to import and test API key resolution
            try {
                results.innerHTML += '<h2>üîß API Key Resolution Test:</h2>';
                
                // Import the API key resolver
                const { resolveGeminiApiKey } = await import('/src/shared/utils/apiKeys.ts');
                
                const resolvedKey = await resolveGeminiApiKey();
                results.innerHTML += `<p>resolveGeminiApiKey(): ${resolvedKey ? `‚úÖ RESOLVED (${resolvedKey.substring(0,8)}...)` : '‚ùå NULL'}</p>`;
                
                // Test localStorage setting
                if (!resolvedKey && import.meta.env.VITE_GEMINI_API_KEY) {
                    results.innerHTML += '<h2>üõ†Ô∏è Setting API key in localStorage:</h2>';
                    const settings = { geminiApiKey: import.meta.env.VITE_GEMINI_API_KEY };
                    localStorage.setItem('app-settings', JSON.stringify(settings));
                    results.innerHTML += '<p>‚úÖ API key stored in localStorage</p>';
                    
                    // Test again
                    const resolvedKey2 = await resolveGeminiApiKey();
                    results.innerHTML += `<p>resolveGeminiApiKey() after storage: ${resolvedKey2 ? `‚úÖ RESOLVED (${resolvedKey2.substring(0,8)}...)` : '‚ùå STILL NULL'}</p>`;
                }
                
            } catch (error) {
                results.innerHTML += `<p>‚ùå Import/resolution error: ${error.message}</p>`;
                console.error('Debug error:', error);
            }
        }
        
        debugKeyDetection();
    </script>
</body>
</html>
